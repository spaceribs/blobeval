"use strict";(function(){function getFuncBody(func){return func.toString().match(/\{([\s\S]*)\}/m)[1].replace(/(^\s+|\s+$)/g,"")}function getBlobBody(func,blacklist,whitelist){var funcBody="",bl=blacklist||[],wl=whitelist||[];if(funcBody+="'use strict';\n\n",wl.length)for(var e=0;e<wl.length;e++)funcBody+="self.importScripts('"+wl[e]+"');\n";if(funcBody+="\n",bl.length)for(var i=0;i<bl.length;i++)funcBody+="self['"+bl[i]+"'] = undefined;\n";return funcBody+="\n",funcBody+=getFuncBody(func)}function createWorker(settings,onerror){var blobFunc,blob,blobURL;blobFunc=function(){self.onmessage=function(_msg){var scope=_msg.data.scope,func=new Function(_msg.data.func),output=func.call(scope);self.postMessage({message:output,scope:scope})}};var funcBody=getBlobBody(blobFunc,settings.blacklist,settings.includes,!0);try{blob=new Blob([funcBody],{type:"text/javascript"})}catch(err){if("TypeError"===err.name&&BlobBuilder){var bb=new BlobBuilder;bb.append(getBlobBody(blobFunc,!0)),blob=bb.getBlob("text/javascript")}else onerror(err)}return blobURL=URL.createObjectURL(blob),new Worker(blobURL)}function extend(destination,source){for(var property in source)source.hasOwnProperty(property)&&(destination[property]=source[property]);return destination}var Blobeval={version:"0.1"},BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,URL=window.URL||window.webkitURL,defaults={timeout:1e3,includes:[],blacklist:["Worker","addEventListener","removeEventListener","importScripts","XMLHttpRequest","dispatchEvent","eval"]};Blobeval.evaluate=function(func,onsuccess,onerror,data,options){var evalString,evalTimeout,worker,successCallback=onsuccess||function(){},errorCallback=onerror||function(){},scope=extend({},data),settings=extend(defaults,options);if("function"==typeof func)evalString=getFuncBody(func);else{if("string"!=typeof func)return errorCallback(new TypeError("Evaluation parameter must be a function or a string.")),!1;evalString=func}return settings.timeout&&(evalTimeout=window.setTimeout(function(){worker.onerror(new Error("TimeoutError: Evaluation failed after "+settings.timeout+"ms."))},settings.timeout)),worker=createWorker(settings,errorCallback),worker.postMessage({func:evalString,scope:scope}),worker.onerror=function(err){window.clearTimeout(evalTimeout),errorCallback(err),worker.terminate()},worker.onmessage=function(msg){window.clearTimeout(evalTimeout),successCallback({message:msg.data.message,scope:msg.data.scope}),worker.terminate()},!0},this.Blobeval=Blobeval}).call(this);